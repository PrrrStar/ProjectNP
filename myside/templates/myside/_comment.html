{% load static %}

<div class="detail__comment">
  <div class="comment__header">
    <div class="comment__header--title">
      <img src="{% static 'logo/point.png' %}" class="point" />
      상품후기({{ product.comments.count }}개)
      <!-- 회원만 댓글달 수 있는 창이 보입니다. -->
    </div>
  </div>
  <div class="comment__main">
    <div class="comment__mycomment">
      {% if request.user.is_authenticated %}
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#comment-modal">댓글 작성하기</button>

      <!-- 댓글 작성하기 버튼입니다. -->
      <!-- 버튼을 누르면 댓글을 작성하는 modal이 나타납니다. -->
      <div class="modal fade" id="comment-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">New message</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <form method="POST" action="{% url 'comment_create' product.slug %}" id="comment-form" enctype="multipart/form-data">
              {% csrf_token %}
              <div class="modal-body">
                <span class="comment__user"> {{ user.nickname }} 님의 후기 </span>
                <span class="star-input">
                  <span class="input">
                    <input type="radio" name="star-input" id="p1" value="0.5" /><label for="p1">0.5</label> <input type="radio" name="star-input" id="p2" value="1" /><label for="p2">1</label>
                    <input type="radio" name="star-input" id="p3" value="1.5" /><label for="p3">1.5</label> <input type="radio" name="star-input" id="p4" value="2" /><label for="p4">2</label>
                    <input type="radio" name="star-input" id="p5" value="2.5" /><label for="p5">2.5</label> <input type="radio" name="star-input" id="p6" value="3" /><label for="p6">3</label>
                    <input type="radio" name="star-input" id="p7" value="3.5" /><label for="p7">3.5</label> <input type="radio" name="star-input" id="p8" value="4" /><label for="p8">4</label>
                    <input type="radio" name="star-input" id="p9" value="4.5" /><label for="p9">4.5</label> <input type="radio" name="star-input" id="p10" value="5" /><label for="p10">5</label>
                  </span>
                  <output for="star-input"><b>0</b>점</output>
                </span>

                <div class="preview">
                  <img src="" id="preview-img" width="100" height="100" />
                </div>
                <div>{{comment_form.content}} {{comment_form.img}}</div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="submit" id="btn-comment" class="btn btn-primary">댓글 쓰기</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <!-- 여기까지가 modal 입니다. -->
    </div>
    {% endif %}
    <!-- 달린 댓글들 표시 -->

    <div class="comment__comments">
      {% for comment in product.comments.all %}
      <div class="comments">
        <div class="comments__content">
          <!-- comment__propfile에 프사가 들어갈거에요 -->
          {% if comment.author.profile %}
          <img class="comments__profile" src="{{comment.author.profile.url}}" />
          {% endif %}
          <div class="comments__commentBox">
            <span class="comments__user"> {{ comment.author.nickname }} </span>
            <button type="button" class="btn-like-comment" data-url="{{ comment.get_api_like_url }}" data-like="{{comment.like.count}}">
              <img src="{% static 'logo/thumb_up_alt-24px.png' %}" />
              <span class="like-comment-count"> {{comment.like.count}} </span>
            </button>
            <span class="comments__comment">{{ comment.content }}</span>
          </div>
          <div>
            <span>별점 : {{comment.stars}}</span>
          </div>
        </div>
        {% if comment.img %}
        <img src="{{ comment.img.url }}" alt="comment IMG" class="comments__img" enlarge="f" />
        {% endif %}

        <!-- 로그인 유저 중 내가 쓴 댓글만 수정 삭제 보이게 설정-->
        {% if user.is_authenticated %} {% if user == comment.author %}
        <form method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <button onclick="" type="submit">수정</button>
          <button onclick="" type="submit">삭제</button>
        </form>
        {% endif %} {% endif %}
      </div>
      {% endfor %}
      <div class="comments__showMore">더보기</div>
      <div class="image-layer"></div>
    </div>
  </div>
</div>
