{% load static %}


{% for comment in product.comments.all %}
<div class="comments">
  <div class="comments__content">
    {% if comment.author.profile %}
    <img class="comments__profile" src="{{comment.author.profile.url}}" />
    {% else %}
    <img class="comments__profile" src="{% static 'logo/heart__white.png' %}" />
    {% endif %}
    <div class="comments__commentBox">
      <span class="comments__user"> {{ comment.author.nickname }} </span>
      <button type="button" class="btn-like-comment" data-url="{{ comment.get_api_like_url }}"
        data-like="{{comment.like.count}}">
        <img src="{% static 'logo/thumb_up_alt-24px.png' %}" />
        <span class="like-comment-count"> {{comment.like.count}} </span>
      </button>
      <span class="comments__comment">{{ comment.content }}</span>
    </div>
    <div>
      <span>별점 : {{comment.stars}}</span>
    </div>
  </div>
  {% if comment.img %}
  <img src="{{ comment.img.url }}" alt="comment IMG" class="comments__img" enlarge="f" />
  {% endif %}

  <!-- 로그인 유저 중 내가 쓴 댓글만 수정 삭제 보이게 설정-->
  {% if user.is_authenticated %} {% if user == comment.author %}
  <input type="button" class="btn btn-info btn-sm comment_delete" name="{{ comment.id }}" value="삭제">
  {% endif %} {% endif %}
</div>
{% endfor %}

<div class="comments__showMore">더보기</div>
<div class="image-layer"></div>

<script src="{% static 'js/like-comment-toggle.js' %}"></script>
<script src="{% static 'js/moreComments.js' %}"></script>
<script src="{% static 'js/enlargeImage.js' %}"></script>

<script type="text/javascript">
  $(".comment_delete").click(function () {
    var delete_warning = confirm('댓글을 삭제하시겠습니까?');
    var pk = $(this).attr('name')
    if (delete_warning == true) {
      comment = $(this).parent('div');
      $.ajax({ // ajax로 서버와 통신
        type: "POST", // 데이터를 전송하는 방법
        url: "{% url 'product_comment_delete' %}", // 통신할 url을 지정
        data: { 'pk': pk, 'csrfmiddlewaretoken': '{{ csrf_token }}' }, // 서버로 데이터 전송시 옵션, pk를 넘겨야 어떤 video인지 알 수 있음
        dataType: "json",
        success: function (response) { // 성공
          comment.remove();
        },
        error: function (request, status, error) { // 실패
          alert("로그인이 필요합니다.")
          window.location.replace("/") // 로그인 페이지로 넘어가기
        },
      });
    }
  })
</script>